---
title: "Working pipeline"
output:
  html_document:
    df_print: paged
---
## 1) Import data. 

Source data should have column with speaker identifiers (e.g., usernames) and one withe text (e.g., social media posts)

```{r}
library(tidyverse)
devtools::install_github("davidemorselli/speakerlandscapes")
library(speakerlandscapes)

data = read_csv("raw_corpus.csv")
head(data)

```
## 2) Make data ready to build landscapes.

This create a \code{speakers_text} object: a character vector in which the first token is the speaker name, prefixed by an identifying token (e.g. "agent"). Bigrams and trigrams are found in the text and replaced by single tokens (e.g., word1_word2)

```{r}

ready_data = prepare_data(data, 
                          speaker_id_column = "speaker", 
                          text_column = "text", 
                          speaker_identifier = "agent")

head(ready_data)

```

## 3) Make the embedding

Compute the embeddings from the \code{speakers_text} object.

```{r}
embedding = train_embedding_model(ready_data, 
                                  min_count = 1,  #Beware, min_count=1 is only for the example. It indicate minimum frequency required for a token to be included in the vocabulary. A higher number is preferable
                                  stopwords_language = "en")


```

# 4) Make the speaker landscape.

This step use UMAP to reduce the 250-dimension embedding to a more interpretable 2-dimension and extract speakers vectors. Other tokens present in the embedding can be also specified here to be plotted in the next step. In this exemple we use the \code{get_most_frequent_tokens()} function to extract the words that appear at least 10 times in the text. 

```{r}
frequent_words = get_most_frequent_tokens(ready_data, min_count = 10, stopwords_language = "en")

landscape = make_speaker_landscapes(data = ready_data ,
                                    embedding = embedding, 
                                    tokens_to_plot = frequent_words,
                                    speaker_identifier = "agent",
                                    retain_threshold = 1,
                                    n_neighbors = 30,
                                    min_dist = 0.01) 


```

## 5) Plot the speaker landscape.

Plot the speaker landscape along with word tokens specified in the previous step.

```{r}
plot_speaker_landscapes(landscape, alpha_points = .6, size_points = 1)

```

